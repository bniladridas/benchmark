#!/bin/bash

set -euo pipefail

# Pre-push hook to run ruff checks

# Determine repo root and prefer venv ruff
REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT"

RUFF_CMD="$REPO_ROOT/venv/bin/ruff"
if [ ! -x "$RUFF_CMD" ]; then
  RUFF_CMD="ruff"
fi

echo "running ruff checks..."
if ! $RUFF_CMD check .; then
  echo "Ruff check failed. Please fix the issues before pushing."
  exit 1
fi

if ! $RUFF_CMD format --check .; then
  echo "Ruff format check failed. Please run 'ruff format .' to fix."
  exit 1
fi

echo "Ruff checks passed."